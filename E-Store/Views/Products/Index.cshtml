@model IEnumerable<ProductVM>

@{
    ViewData["Title"] = "Products";
}

<link href="~/lib/datatables/datatables.min.css" rel="stylesheet" />
<link href="~/lib/datatables/datatables-1.13.6/css/datatables.bootstrap5.min.css" rel="stylesheet" />

<div class="my-4">
    <div class="mb-3 d-flex justify-content-between">
        <h4 class="text-uppercase text-dim"><strong>Products</strong></h4>
        <a asp-action="Create" class="btn btn-outline-success px-4">Create</a>
    </div>
    @*@foreach (var product in Model)
    {
        <div class="card mb-3">
            <div class="row g-0">
                <div class="col-lg-2 col-md-3 p-3">
                    <img src="~/@product.ImageUrl" class="img-fluid" alt="...">
                </div>
                <div class="col-lg-10 col-md-9">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">@product.Name</h5>
                        <p class="card-text">@product.Description</p>
                        <h6 class="text-secondary">Price: <strong>@product.Price.ToString("n")</strong> EGP</h6>
                        <h6 class="text-secondary">Brand: <strong>@product.BrandName</strong></h6>
                        <h6 class="text-secondary">
                            Categories:
                            @foreach (var category in @product.CategoryNames)
                            {
                                <span class="badge bg-secondary" style="margin-bottom:2px;">@category</span>
                            }
                        </h6>
                        <div class="mt-auto ms-md-auto">
                            <a asp-action="Details" class="btn btn-success" asp-route-id="@product.Id"><i class="fa-solid fa-eye"></i></a>
                            <a asp-action="Edit" class="btn btn-warning" asp-route-id="@product.Id"><i class="fa-solid fa-pen-to-square text-light"></i></a>
                            <button value="@product.Id" class="btn btn-danger delete-btn"><i class="fa fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }*@

    <table id="tableData" class="table table-striped" style="width:100%">
        <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.ImageUrl)</th>
                <th>@Html.DisplayNameFor(model => model.Name)</th>
                <th>@Html.DisplayNameFor(model => model.Price)</th>
                <th>@Html.DisplayNameFor(model => model.Stock)</th>
                <th>@Html.DisplayNameFor(model => model.BrandName)</th>
                <th>@Html.DisplayNameFor(model => model.CategoryNames)</th>
                <th></th>
            </tr>
        </thead>
    </table>
</div>

<div class="modal fade" id="delete-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body px-4 py-3">
                <h4 class="my-3 text-danger">Delete Product</h4>
                <div class="mb-3">
                    <p>Are you sure you want to delete this Product?</p>
                </div>
                <form method="post" asp-action="Delete">
                    <input name="id" value="" id="product-id" hidden />
                    <div class="d-flex justify-content-end mb-3">
                        <button type="submit" class="btn btn-danger px-3 me-1">Yes</button>
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"> Cancel </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/lib/datatables/datatables.min.js"></script>
    <script src="~/lib/datatables/datatable.master.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function (event) {
            //jquery datatable logic
            let selector = '#tableData';
            let url = '/Products/GetData';
            let columns = [
                { data: 'imageUrl', orderable: false },
                { data: 'name', orderable: false },
                { data: 'price', orderable: false },
                { data: 'stock', orderable: false },
                { data: 'brandName', orderable: false },
                {
                    data: '', orderable: false, render: function (data, type, row) {
                        var buttons = `<a class="btn btn-success me-1"  href="/Products/Details/${row.id}"><i class="fas fa-eye"></i></a>`;
                        buttons += `<a class="btn btn-warning me-1"  href="/Products/Edit/${row.id}"><i class="fas fa-edit text-white"></i></a>`;
                        buttons += `<button class="btn btn-danger delete-btn"  value="${row.id}"><i class="fa fa-trash"></i></button>`;
                        return `<div class="d-flex justify-content-center nowrap">${buttons}</div>`;
                    }
                }
            ]

            let params = [];
            let dataTable = getData(selector, url, columns, params);

            //delete modal logic
            const deleteRoleModal = new bootstrap.Modal(document.getElementById('delete-modal'));

            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function (e) {
                    document.getElementById('product-id').value = this.value;
                    deleteRoleModal.show();
                });
            });
        });
    </script>
}